ARG  DOCKER_REGISTRY
FROM $DOCKER_REGISTRY/spack-base:latest

ARG  ENV
ARG  CONCRETE_ENV
ARG  SPACK_COMPILER
ARG  SPACK_MPI

COPY envs/$ENV/* /build/
COPY artifacts/ci-$CONCRETE_ENV/spack.* /build/
COPY etc/spack-container-install.sh /build

USER mamba
RUN  $MAMBA_ROOT/bin/mamba env update -n container -f /build/mamba.yaml

USER spack
RUN  bash /build/spack-container-install.sh
