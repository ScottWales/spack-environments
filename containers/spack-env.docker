ARG  DOCKER_REGISTRY
FROM $DOCKER_REGISTRY/spack-base:latest

ARG  CONTAINER_ENV

COPY artifacts/ci-$CONTAINER_ENV/spack.* /build/

RUN  source $SPACK_ROOT/share/spack/setup-env.sh \
&&   spack env create container /build/spack.lock \
&&   spack env activate container \
&&   spack mirror add gitlab file://$SPACK_CACHE \
&&   spack install --use-buildcache=only --no-check-signature
